var e=Object.defineProperty,s=Object.defineProperties,r=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,n=(s,r,o)=>r in s?e(s,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[r]=o,p=(e,s)=>{var r={};for(var n in e)t.call(e,n)&&s.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&o)for(var n of o(e))s.indexOf(n)<0&&a.call(e,n)&&(r[n]=e[n]);return r};import{J as l,V as c,O as i,c as f,o as u,w as m,a3 as d,R as h,S as g,D as y,M as v,a0 as b,a1 as O,aW as w,ao as j,T as x,i as P,_ as E}from"./index-DFl-DtYN.js";import{u as k,_}from"./wd-toast.CkqgZtH9.js";import{u as C}from"./useChildren.Bm28azSF.js";import{f as T,F as I}from"./types.-oL-Sf5V.js";const M=l((S=((e,s)=>{for(var r in s||(s={}))t.call(s,r)&&n(e,r,s[r]);if(o)for(var r of o(s))a.call(s,r)&&n(e,r,s[r]);return e})({},{name:"wd-form",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"}}),D={props:T,setup(e,{expose:s}){const{show:r}=k("wd-form-toast"),o=e,{children:t,linkChildren:a}=C(I);let n=c({});function l(e){e?n[e]="":Object.keys(n).forEach(e=>{n[e]=""})}return a({props:o,errorMessages:n}),i(()=>o.model,()=>{o.resetOnChange&&l()},{immediate:!0,deep:!0}),s({validate:function(e){return s=this,a=null,c=function*(){const s=[];let a=!0;const c=[],i=function(){const e=x(o.rules),s=t.map(e=>e.prop);return Object.keys(e).forEach(r=>{s.includes(r)||delete e[r]}),t.forEach(s=>{b(s.prop)&&b(s.rules)&&s.rules.length&&(e[s.prop]?e[s.prop]=[...e[s.prop],...s.rules]:e[s.prop]=s.rules)}),e}(),f=v(e)?e:b(e)?[e]:[],u=f.length>0?f.reduce((e,s)=>(i[s]&&(e[s]=i[s]),e),{}):i;for(const e in u){const r=u[e],t=O(o.model,e);if(r&&r.length>0)for(const o of r){if(o.required&&(!b(t)||""===t)){s.push({prop:e,message:o.message}),a=!1;break}if(o.pattern&&!o.pattern.test(t)){s.push({prop:e,message:o.message}),a=!1;break}const r=o,{validator:n}=r,l=p(r,["validator"]);if(n){const r=n(t,l);w(r)?c.push(r.then(r=>{"string"==typeof r?(s.push({prop:e,message:r}),a=!1):"boolean"!=typeof r||r||(s.push({prop:e,message:o.message}),a=!1)}).catch(r=>{const t=b(r)?j(r)?r:r.message||o.message:o.message;s.push({prop:e,message:t}),a=!1})):r||(s.push({prop:e,message:o.message}),a=!1)}}}return yield Promise.all(c),function(e){const s=t.map(e=>e.prop).filter(Boolean),a=e.filter(e=>e.message&&s.includes(e.prop));a.length&&(a.sort((e,r)=>s.indexOf(e.prop)-s.indexOf(r.prop)),"toast"===o.errorType?r(a[0].message):"message"===o.errorType&&a.forEach(e=>{n[e.prop]=e.message}))}(s),a&&(f.length?f.forEach(l):l()),{valid:a,errors:s}},new Promise((e,r)=>{var o=e=>{try{n(c.next(e))}catch(s){r(s)}},t=e=>{try{n(c.throw(e))}catch(s){r(s)}},n=s=>s.done?e(s.value):Promise.resolve(s.value).then(o,t);n((c=c.apply(s,a)).next())});var s,a,c},reset:function(){l()}}),(e,s)=>{const r=P;return u(),f(r,{class:y(`wd-form ${e.customClass}`),style:g(e.customStyle)},{default:m(()=>[d(e.$slots,"default",{},void 0,!0),"toast"===o.errorType?(u(),f(_,{key:0,selector:"wd-form-toast"})):h("",!0)]),_:3},8,["class","style"])}}},s(S,r(D))));var S,D;const $=E(M,[["__scopeId","data-v-977d4bc0"]]);export{$ as _};
//# sourceMappingURL=wd-form.DL6TOz2J.js.map
