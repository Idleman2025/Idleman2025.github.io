{"version":3,"file":"wd-rate.BOFWL5Dj.js","sources":["../../../../src/uni_modules/wot-design-uni/components/wd-rate/types.ts","../../../../src/uni_modules/wot-design-uni/components/wd-rate/wd-rate.vue"],"sourcesContent":["import type { PropType } from 'vue'\nimport { baseProps, makeBooleanProp, makeNumberProp, makeStringProp } from '../common/props'\n\nexport const rateProps = {\n  ...baseProps,\n\n  /**\n   * 评分最大值\n   * 类型: number\n   * 默认值: 5\n   */\n  num: makeNumberProp(5),\n\n  /**\n   * 当前分数，使用v-model进行双向绑定\n   * 类型: string | number | null\n   * 默认值: null\n   */\n  modelValue: {\n    type: [String, Number, null] as PropType<string | number | null>,\n    default: null\n  },\n\n  /**\n   * 是否只读\n   * 类型: boolean\n   * 默认值: false\n   */\n  readonly: makeBooleanProp(false),\n\n  /**\n   * 图标大小\n   * 类型: string\n   * 默认值: '16px'\n   */\n  size: makeStringProp('16px'),\n\n  /**\n   * 图标间距\n   * 类型: string\n   * 默认值: '4px'\n   */\n  space: makeStringProp('4px'),\n\n  /**\n   * 未选中的图标颜色\n   * 类型: string\n   * 默认值: '#E8E8E8'\n   */\n  color: makeStringProp('#E8E8E8'),\n\n  /**\n   * 选中的图标颜色，支持传颜色数组（用于分段颜色）\n   * 类型: string | Array<string>\n   * 默认值: 'linear-gradient(180deg, rgba(255,238,0,1) 0%,rgba(250,176,21,1) 100%)'\n   */\n  activeColor: {\n    type: [String, Array] as PropType<string | Array<string>>,\n    default: 'linear-gradient(180deg, rgba(255,238,0,1) 0%,rgba(250,176,21,1) 100%)'\n  },\n\n  /**\n   * 未选中的图标类名\n   * 类型: string\n   * 默认值: 'star-on'\n   */\n  icon: makeStringProp('star-on'),\n\n  /**\n   * 选中的图标类名\n   * 类型: string\n   * 默认值: 'star-on'\n   */\n  activeIcon: makeStringProp('star-on'),\n\n  /**\n   * 是否禁用\n   * 类型: boolean\n   * 默认值: false\n   */\n  disabled: makeBooleanProp(false),\n\n  /**\n   * 禁用的图标颜色\n   * 类型: string\n   * 默认值: 'linear-gradient(315deg, rgba(177,177,177,1) 0%,rgba(199,199,199,1) 100%)'\n   */\n  disabledColor: makeStringProp('linear-gradient(315deg, rgba(177,177,177,1) 0%,rgba(199,199,199,1) 100%)'),\n\n  /**\n   * 是否允许半选\n   * 类型: boolean\n   * 默认值: false\n   */\n  allowHalf: makeBooleanProp(false)\n}\n","<template>\n  <view :class=\"`wd-rate ${customClass}`\" :style=\"customStyle\" @touchmove=\"onTouchMove\">\n    <view\n      v-for=\"(rate, index) in rateList\"\n      :key=\"index\"\n      :data-index=\"index\"\n      :style=\"{ 'margin-right': index == rateList.length - 1 ? 0 : space }\"\n      class=\"wd-rate__item\"\n    >\n      <wd-icon\n        custom-class=\"wd-rate__item-star\"\n        :name=\"isActive(rate) ? activeIcon : icon\"\n        :size=\"size\"\n        :custom-style=\"rate === '100%' ? iconActiveStyle : iconStyle\"\n        @click=\"changeRate(index, false)\"\n      />\n      <view v-if=\"props.allowHalf\" class=\"wd-rate__item-half\" @click.stop=\"changeRate(index, true)\">\n        <wd-icon\n          custom-class=\"wd-rate__item-star\"\n          :name=\"isActive(rate) ? activeIcon : icon\"\n          :size=\"size\"\n          :custom-style=\"rate !== '0' ? iconActiveStyle : iconStyle\"\n        />\n      </view>\n    </view>\n  </view>\n</template>\n\n<script lang=\"ts\">\nexport default {\n  name: 'wd-rate',\n  options: {\n    addGlobalClass: true,\n    virtualHost: true,\n    styleIsolation: 'shared'\n  }\n}\n</script>\n<script lang=\"ts\" setup>\nimport wdIcon from '../wd-icon/wd-icon.vue'\nimport { computed, getCurrentInstance, ref, watch } from 'vue'\nimport { rateProps } from './types'\nimport { getRect } from '../common/util'\nconst { proxy } = getCurrentInstance() as any\n\nconst props = defineProps(rateProps)\nconst emit = defineEmits(['update:modelValue', 'change'])\n\nconst rateList = ref<Array<string>>([])\nconst activeValue = ref<string>('')\n\nconst iconStyle = computed(() => {\n  return `background:${props.color};`\n})\n\nconst iconActiveStyle = computed(() => {\n  return `background:${props.disabled ? props.disabledColor : activeValue.value};`\n})\n\nwatch(\n  () => props.activeColor,\n  (newVal) => {\n    if (Array.isArray(newVal) && !newVal.length) {\n      console.error('activeColor cannot be an empty array')\n    }\n    computeActiveValue()\n  },\n  {\n    immediate: true,\n    deep: true\n  }\n)\n\nwatch(\n  [() => props.num, () => props.modelValue],\n  () => {\n    computeRateList()\n  },\n  {\n    immediate: true,\n    deep: true\n  }\n)\n\n// 当前选项是否为激活状态\nconst isActive = (rate: string) => {\n  return rate !== '0'\n}\n\n/**\n * @description 计算当前应当展示的rate数量\n */\nfunction computeRateList() {\n  const { modelValue, num, allowHalf } = props\n  // value和num都准备好才能计算\n  if (modelValue === null || !num) return\n  if (typeof modelValue !== 'number') {\n    console.error('[wot ui] error(wd-rate): the value of wd-rate should be a number')\n    return\n  }\n  const tempRateList: string[] = []\n  const fullLength = Math.floor(modelValue)\n  for (let i = 0; i < num; i++) {\n    if (i < fullLength) {\n      tempRateList.push('100%')\n    } else if (i === fullLength && allowHalf && modelValue % 1 !== 0) {\n      tempRateList.push('50%')\n    } else {\n      tempRateList.push('0')\n    }\n  }\n  rateList.value = tempRateList\n  computeActiveValue()\n}\n/**\n * @description 计算当前应当展示的rate颜色\n */\nfunction computeActiveValue() {\n  const { activeColor, modelValue, num } = props\n  let tempActiveValue: string = ''\n  if (Array.isArray(activeColor) && activeColor.length) {\n    tempActiveValue = Number(modelValue) <= num * 0.6 || !activeColor[1] ? activeColor[0] : activeColor[1]\n  } else {\n    tempActiveValue = activeColor as string\n  }\n  activeValue.value = tempActiveValue\n}\n/**\n * @description 点击icon触发组件的change事件\n */\nfunction changeRate(index: number, isHalf: boolean) {\n  if (props.readonly || props.disabled) return\n  const value = isHalf ? index + 0.5 : index + 1\n  emit('update:modelValue', value)\n  emit('change', {\n    value\n  })\n}\n\nasync function onTouchMove(event: TouchEvent) {\n  const { clientX } = event.touches[0]\n  const rateItems = await getRect('.wd-rate__item', true, proxy)\n  const targetIndex = Array.from(rateItems).findIndex((rect) => {\n    return clientX >= rect.left! && clientX <= rect.right!\n  })\n  if (targetIndex !== -1) {\n    const target = rateItems[targetIndex]\n    const itemWidth = target.width!\n    const isHalf = props.allowHalf && clientX - target.left! < itemWidth / 2\n    const value = isHalf ? targetIndex + 0.5 : targetIndex + 1\n    if (value >= 0.5) {\n      changeRate(targetIndex, isHalf)\n    }\n  }\n}\n</script>\n<style lang=\"scss\" scoped>\n@import './index.scss';\n</style>\n"],"names":["rateProps","__spreadProps","baseProps","num","makeNumberProp","modelValue","type","String","Number","default","readonly","makeBooleanProp","size","makeStringProp","space","color","activeColor","Array","icon","activeIcon","disabled","disabledColor","allowHalf","name","options","addGlobalClass","virtualHost","styleIsolation","proxy","getCurrentInstance","props","__props","emit","__emit","rateList","ref","activeValue","iconStyle","computed","iconActiveStyle","value","watch","newVal","isArray","length","console","error","computeActiveValue","immediate","deep","tempRateList","fullLength","Math","floor","i","push","computeRateList","isActive","rate","tempActiveValue","changeRate","index","isHalf","onTouchMove","event","this","clientX","touches","rateItems","getRect","targetIndex","from","findIndex","rect","left","right","target","itemWidth","width"],"mappings":"imBAGO,MAAMA,EAAYC,OACpBC,GADoB,CAQvBC,IAAKC,EAAe,GAOpBC,WAAY,CACVC,KAAM,CAACC,OAAQC,OAAQ,MACvBC,QAAS,MAQXC,SAAUC,GAAgB,GAO1BC,KAAMC,EAAe,QAOrBC,MAAOD,EAAe,OAOtBE,MAAOF,EAAe,WAOtBG,YAAa,CACXV,KAAM,CAACC,OAAQU,OACfR,QAAS,yEAQXS,KAAML,EAAe,WAOrBM,WAAYN,EAAe,WAO3BO,SAAUT,GAAgB,GAO1BU,cAAeR,EAAe,4EAO9BS,UAAWX,GAAgB,kBCjEd,CACbY,KAAM,UACNC,QAAS,CACPC,gBAAgB,EAChBC,aAAa,EACbC,eAAgB,4EASpB,MAAMC,MAAEA,GAAUC,IAEZC,EAAQC,EACRC,EAAOC,EAEPC,EAAWC,EAAmB,IAC9BC,EAAcD,EAAY,IAE1BE,EAAYC,EAAS,IAClB,cAAcR,EAAMf,UAGvBwB,EAAkBD,EAAS,IACxB,cAAcR,EAAMV,SAAWU,EAAMT,cAAgBe,EAAYI,UAG1EC,EACE,IAAMX,EAAMd,YACX0B,IACKzB,MAAM0B,QAAQD,KAAYA,EAAOE,QACnCC,QAAQC,MAAM,wCAEhBC,KAEF,CACEC,WAAW,EACXC,MAAM,IAIVR,EACE,CAAC,IAAMX,EAAM3B,IAAK,IAAM2B,EAAMzB,YAC9B,MAiBF,WACE,MAAMA,WAAEA,EAAAF,IAAYA,EAAAmB,UAAKA,GAAcQ,EAEvC,GAAmB,OAAfzB,IAAwBF,EAAK,OACjC,GAA0B,iBAAfE,EAET,YADAwC,QAAQC,MAAM,oEAGhB,MAAMI,EAAyB,GACzBC,EAAaC,KAAKC,MAAMhD,GAC9B,IAAA,IAASiD,EAAI,EAAGA,EAAInD,EAAKmD,IACnBA,EAAIH,EACND,EAAaK,KAAK,QACTD,IAAMH,GAAc7B,GAAajB,EAAa,GAAM,EAC7D6C,EAAaK,KAAK,OAElBL,EAAaK,KAAK,KAGtBrB,EAASM,MAAQU,EACjBH,GAAmB,CApCjBS,IAEF,CACER,WAAW,EACXC,MAAM,IAKV,MAAMQ,EAAYC,GACA,MAATA,EA+BT,SAASX,IACP,MAAM/B,YAAEA,EAAAX,WAAaA,EAAAF,IAAYA,GAAQ2B,EACzC,IAAI6B,EAA0B,GAE5BA,EADE1C,MAAM0B,QAAQ3B,IAAgBA,EAAY4B,OAC1BpC,OAAOH,IAAqB,GAANF,IAAca,EAAY,GAAKA,EAAY,GAAKA,EAAY,GAElFA,EAEpBoB,EAAYI,MAAQmB,CAAA,CAKtB,SAASC,EAAWC,EAAeC,GACjC,GAAIhC,EAAMpB,UAAYoB,EAAMV,SAAU,OACtC,MAAMoB,EAAQsB,EAASD,EAAQ,GAAMA,EAAQ,EAC7C7B,EAAK,oBAAqBQ,GAC1BR,EAAK,SAAU,CACbQ,SACD,CAGH,SAAeuB,EAAYC,GAAmB,SAAAC,OAAA,OAAA,YAC5C,MAAMC,QAAEA,GAAYF,EAAMG,QAAQ,GAC5BC,QAAkBC,EAAQ,kBAAkB,EAAMzC,GAClD0C,EAAcrD,MAAMsD,KAAKH,GAAWI,UAAWC,GAC5CP,GAAWO,EAAKC,MAASR,GAAWO,EAAKE,OAElD,IAAoB,IAAhBL,EAAoB,CACtB,MAAMM,EAASR,EAAUE,GACnBO,EAAYD,EAAOE,MACnBhB,EAAShC,EAAMR,WAAa4C,EAAUU,EAAOF,KAAQG,EAAY,GACzDf,EAASQ,EAAc,GAAMA,EAAc,IAC5C,IACXV,EAAWU,EAAaR,EAC1B,CACF,yMAAA"}